{% extends "base.html" %}

{% block css_class_logout %}
    {% if not user.is_authenticated %}
        d-none
    {% endif %}
{% endblock %}
{% block css_class_sign_in %}
    {% if user.is_authenticated %}
        d-none
    {% endif %}
{% endblock %}

{% block content %}
    <div class="row mx-auto">
        <div class="col">{{ user.profile.money }}</div>
        <form method="post" class="col">
            {% csrf_token %}
            <div class="form-group col">
                <label>Select location</label>
                <select name="location" class="form-control" onchange="get_nodes(this.value)">
                    <option value="0"></option>
                    {% for i in locations %}
                        <option value="{{ i.id }}">{{ i.city }}, {{ i.street }}, {{ i.building }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group col">
                <label>Select computer</label>
                <select name="computer" class="form-control">
                </select>
            </div>
            <div class="form-group col">
                <label>time</label>
                <input name="time" type="text" class="form-control">
            </div>
            <div class="form-group col">
                <label>period</label>
                <input name="period" type="text" class="form-control">
            </div>
            <div class="form-group col">
                <label>{{ result }}</label>
            </div>
            <button type="submit" class="col btn btn-primary">Submit</button>
        </form>
    </div>
{% endblock %}

{% block script %}
    <script>
        var socket = new WebSocket("ws://localhost:8000/users/");
        socket.onopen = function () {
            alert("Соединение установлено.");
        };

        socket.onclose = function (event) {
            if (event.wasClean) {
                alert('Соединение закрыто чисто');
            } else {
                alert('Обрыв соединения'); // например, "убит" процесс сервера
            }
            alert('Код: ' + event.code + ' причина: ' + event.reason);
        };

        socket.onmessage = function (event) {
            alert("Получены данные " + event.data);
        };

        socket.onerror = function (error) {
            alert("Ошибка " + error.message);
        };

        function get_nodes(location_id) {
            socket.send(JSON.stringify({"command": "get_nodes", "location": location_id}))
        }
    </script>
{% endblock %}